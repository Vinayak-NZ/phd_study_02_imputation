"hypertension",
"heart_disease",
"heart_failure",
"selfcare_t0",
paste0(var, "_t2"))]
return(list(data_t1_complete, data_t2))
}
simulate_missing_t2 <- function(data_t2_subset, var, proportion, miss_mech){
data_subset_t2_missing <- ampute(data_t2_subset,
prop = proportion,
patterns = patterns,
mech = miss_mech)
data_subset_t2_missing_output <-
data_subset_t2_missing$amp[, c("id", paste0(var, "_t2"))]
return(data_subset_t2_missing_output)
}
combine_simulations <- function(data_t1_missing, data_t1_complete, data_t2){
data_t2_t1_merge <- merge(data_t1_complete, data_t2, by = "id")
simulation_output <- rbind(data_t1_missing, data_t2_t1_merge)
simulation_output <- simulation_output[order(simulation_output$id), ]
return(simulation_output)
}
t1_output <- simulate_missing_t1(data = data,
var = var,
proportion = proportion,
miss_mech = miss_mech)
t2_input <- create_t2_input(data = t1_output[[3]],
var = var,
data_subset_t1_missing_output = t1_output[[1]])
t2_output <- simulate_missing_t2(data_t2_subset = t2_input[[2]],
var = var,
proportion = proportion,
miss_mech = miss_mech)
simulation_output <- combine_simulations(data_t1_missing = t1_output[[2]],
data_t1_complete = t2_input[[1]],
data_t2 = t2_output)
View(simulation_output)
simulate_missingness <- function(data, var, proportion, miss_mech){
t1_output <- simulate_missing_t1(data = data,
var = var,
proportion = proportion,
miss_mech = miss_mech)
t2_input <- create_t2_input(data = t1_output[[3]],
var = var,
data_subset_t1_missing_output = t1_output[[1]])
t2_output <- simulate_missing_t2(data_t2_subset = t2_input[[2]],
var = var,
proportion = proportion,
miss_mech = miss_mech)
simulation_output <- combine_simulations(data_t1_missing = t1_output[[2]],
data_t1_complete = t2_input[[1]],
data_t2 = t2_output)
return(simulation_output)
}
simulate_missingness <- simulate_missing(data = synthetic_data_subset,
var = "selfcare",
proportion = 0.2,
miss_mech = "MCAR")
data = synthetic_data_subset
var = "selfcare"
proportion = 0.2
miss_mech = "MCAR"
t1_output <- simulate_missing_t1(data = data,
var = var,
proportion = proportion,
miss_mech = miss_mech)
t2_input <- create_t2_input(data = t1_output[[3]],
var = var,
data_subset_t1_missing_output = t1_output[[1]])
t2_output <- simulate_missing_t2(data_t2_subset = t2_input[[2]],
var = var,
proportion = proportion,
miss_mech = miss_mech)
simulation_output <- combine_simulations(data_t1_missing = t1_output[[2]],
data_t1_complete = t2_input[[1]],
data_t2 = t2_output)
source("R/00_load_functions.R")
source("R/00_load_package.R")
source("R/01_load_data.R")
source("R/02_data_edit.R")
source("R/03_create_synthetic_data.R")
simulate_missing_t1 <- function(data, var, proportion, miss_mech){
data$id <- 1:nrow(data)
data_subset_t1 <- data[, c("id",
"randomisation",
"sex",
"age_cat",
"education_cat",
"hypertension",
"heart_disease",
"heart_failure",
paste0(var, "_t0"),
paste0(var, "_t1"))]
patterns <- matrix(c(rep(1, 9), 0),
nrow = 1,
byrow = TRUE)
data_subset_t1_missing <- ampute(data_subset_t1,
prop = proportion,
patterns = patterns,
mech = miss_mech)
data_subset_t1_missing_output <-
data_subset_t1_missing$amp
data_t1_missing_only <-
data_subset_t1_missing_output[is.na(data_subset_t1_missing_output[[paste0(var, "_t1")]]), ]
data_t1_missing_only[[paste0(var, "_t2")]] <- NA
return(list(data_subset_t1_missing_output, data_t1_missing_only, data))
}
create_t2_input <- function(data, var, data_subset_t1_missing_output){
data_t1_complete <-
data_subset_t1_missing_output[complete.cases(data_subset_t1_missing_output), ]
data_t1_complete_id <- data_t1_complete[, "id"]
data_t2 <- data[data$id %in% data_t1_complete_id,
c("id",
"randomisation",
"sex",
"age_cat",
"education_cat",
"hypertension",
"heart_disease",
"heart_failure",
"selfcare_t0",
paste0(var, "_t2"))]
return(list(data_t1_complete, data_t2))
}
simulate_missing_t2 <- function(data_t2_subset, var, proportion, miss_mech){
data_subset_t2_missing <- ampute(data_t2_subset,
prop = proportion,
patterns = patterns,
mech = miss_mech)
data_subset_t2_missing_output <-
data_subset_t2_missing$amp[, c("id", paste0(var, "_t2"))]
return(data_subset_t2_missing_output)
}
combine_simulations <- function(data_t1_missing, data_t1_complete, data_t2){
data_t2_t1_merge <- merge(data_t1_complete, data_t2, by = "id")
simulation_output <- rbind(data_t1_missing, data_t2_t1_merge)
simulation_output <- simulation_output[order(simulation_output$id), ]
return(simulation_output)
}
simulate_missingness <- function(data, var, proportion, miss_mech){
t1_output <- simulate_missing_t1(data = data,
var = var,
proportion = proportion,
miss_mech = miss_mech)
t2_input <- create_t2_input(data = t1_output[[3]],
var = var,
data_subset_t1_missing_output = t1_output[[1]])
t2_output <- simulate_missing_t2(data_t2_subset = t2_input[[2]],
var = var,
proportion = proportion,
miss_mech = miss_mech)
simulation_output <- combine_simulations(data_t1_missing = t1_output[[2]],
data_t1_complete = t2_input[[1]],
data_t2 = t2_output)
return(simulation_output)
}
test <- simulate_missing(data = synthetic_data_subset,
var = "selfcare",
proportion = 0.2,
miss_mech = "MCAR")
test <- simulate_missing(data = synthetic_data_subset,
var = "selfcare",
proportion = 0.2,
miss_mech = "MCAR")
test <- simulate_missingness(data = synthetic_data_subset,
var = "selfcare",
proportion = 0.2,
miss_mech = "MCAR")
simulate_missing_t1 <- function(data, var, proportion, miss_mech){
data$id <- 1:nrow(data)
data_subset_t1 <- data[, c("id",
"randomisation",
"sex",
"age_cat",
"education_cat",
"hypertension",
"heart_disease",
"heart_failure",
paste0(var, "_t0"),
paste0(var, "_t1"))]
patterns <- matrix(c(rep(1, 9), 0),
nrow = 1,
byrow = TRUE)
data_subset_t1_missing <- mice::ampute(data_subset_t1,
prop = proportion,
patterns = patterns,
mech = miss_mech)
data_subset_t1_missing_output <-
data_subset_t1_missing$amp
data_t1_missing_only <-
data_subset_t1_missing_output[is.na(data_subset_t1_missing_output[[paste0(var, "_t1")]]), ]
data_t1_missing_only[[paste0(var, "_t2")]] <- NA
return(list(data_subset_t1_missing_output, data_t1_missing_only, data))
}
create_t2_input <- function(data, var, data_subset_t1_missing_output){
data_t1_complete <-
data_subset_t1_missing_output[complete.cases(data_subset_t1_missing_output), ]
data_t1_complete_id <- data_t1_complete[, "id"]
data_t2 <- data[data$id %in% data_t1_complete_id,
c("id",
"randomisation",
"sex",
"age_cat",
"education_cat",
"hypertension",
"heart_disease",
"heart_failure",
"selfcare_t0",
paste0(var, "_t2"))]
return(list(data_t1_complete, data_t2))
}
simulate_missing_t2 <- function(data_t2_subset, var, proportion, miss_mech){
data_subset_t2_missing <- mice::ampute(data_t2_subset,
prop = proportion,
patterns = patterns,
mech = miss_mech)
data_subset_t2_missing_output <-
data_subset_t2_missing$amp[, c("id", paste0(var, "_t2"))]
return(data_subset_t2_missing_output)
}
combine_simulations <- function(data_t1_missing, data_t1_complete, data_t2){
data_t2_t1_merge <- merge(data_t1_complete, data_t2, by = "id")
simulation_output <- rbind(data_t1_missing, data_t2_t1_merge)
simulation_output <- simulation_output[order(simulation_output$id), ]
return(simulation_output)
}
simulate_missingness <- function(data, var, proportion, miss_mech){
t1_output <- simulate_missing_t1(data = data,
var = var,
proportion = proportion,
miss_mech = miss_mech)
t2_input <- create_t2_input(data = t1_output[[3]],
var = var,
data_subset_t1_missing_output = t1_output[[1]])
t2_output <- simulate_missing_t2(data_t2_subset = t2_input[[2]],
var = var,
proportion = proportion,
miss_mech = miss_mech)
simulation_output <- combine_simulations(data_t1_missing = t1_output[[2]],
data_t1_complete = t2_input[[1]],
data_t2 = t2_output)
return(simulation_output)
}
test <- simulate_missingness(data = synthetic_data_subset,
var = "selfcare",
proportion = 0.2,
miss_mech = "MCAR")
simulate_missing_t2 <- function(data_t2_subset, var, proportion, miss_mech){
patterns <- matrix(c(rep(1, 9), 0),
nrow = 1,
byrow = TRUE)
data_subset_t2_missing <- mice::ampute(data_t2_subset,
prop = proportion,
patterns = patterns,
mech = miss_mech)
data_subset_t2_missing_output <-
data_subset_t2_missing$amp[, c("id", paste0(var, "_t2"))]
return(data_subset_t2_missing_output)
}
simulate_missing_t1 <- function(data, var, proportion, miss_mech){
data$id <- 1:nrow(data)
data_subset_t1 <- data[, c("id",
"randomisation",
"sex",
"age_cat",
"education_cat",
"hypertension",
"heart_disease",
"heart_failure",
paste0(var, "_t0"),
paste0(var, "_t1"))]
patterns <- matrix(c(rep(1, 9), 0),
nrow = 1,
byrow = TRUE)
data_subset_t1_missing <- mice::ampute(data_subset_t1,
prop = proportion,
patterns = patterns,
mech = miss_mech)
data_subset_t1_missing_output <-
data_subset_t1_missing$amp
data_t1_missing_only <-
data_subset_t1_missing_output[is.na(data_subset_t1_missing_output[[paste0(var, "_t1")]]), ]
data_t1_missing_only[[paste0(var, "_t2")]] <- NA
return(list(data_subset_t1_missing_output, data_t1_missing_only, data))
}
create_t2_input <- function(data, var, data_subset_t1_missing_output){
data_t1_complete <-
data_subset_t1_missing_output[complete.cases(data_subset_t1_missing_output), ]
data_t1_complete_id <- data_t1_complete[, "id"]
data_t2 <- data[data$id %in% data_t1_complete_id,
c("id",
"randomisation",
"sex",
"age_cat",
"education_cat",
"hypertension",
"heart_disease",
"heart_failure",
"selfcare_t0",
paste0(var, "_t2"))]
return(list(data_t1_complete, data_t2))
}
simulate_missing_t2 <- function(data_t2_subset, var, proportion, miss_mech){
patterns <- matrix(c(rep(1, 9), 0),
nrow = 1,
byrow = TRUE)
data_subset_t2_missing <- mice::ampute(data_t2_subset,
prop = proportion,
patterns = patterns,
mech = miss_mech)
data_subset_t2_missing_output <-
data_subset_t2_missing$amp[, c("id", paste0(var, "_t2"))]
return(data_subset_t2_missing_output)
}
combine_simulations <- function(data_t1_missing, data_t1_complete, data_t2){
data_t2_t1_merge <- merge(data_t1_complete, data_t2, by = "id")
simulation_output <- rbind(data_t1_missing, data_t2_t1_merge)
simulation_output <- simulation_output[order(simulation_output$id), ]
return(simulation_output)
}
simulate_missingness <- function(data, var, proportion, miss_mech){
t1_output <- simulate_missing_t1(data = data,
var = var,
proportion = proportion,
miss_mech = miss_mech)
t2_input <- create_t2_input(data = t1_output[[3]],
var = var,
data_subset_t1_missing_output = t1_output[[1]])
t2_output <- simulate_missing_t2(data_t2_subset = t2_input[[2]],
var = var,
proportion = proportion,
miss_mech = miss_mech)
simulation_output <- combine_simulations(data_t1_missing = t1_output[[2]],
data_t1_complete = t2_input[[1]],
data_t2 = t2_output)
return(simulation_output)
}
test <- simulate_missingness(data = synthetic_data_subset,
var = "selfcare",
proportion = 0.2,
miss_mech = "MCAR")
View(test)
results_mcar_20 <- list()
for (sim in 1:100) {
simulate_missingness <- simulate_missing(data = synthetic_data_subset,
var = "selfcare",
proportion = 0.2,
miss_mech = "MCAR")
results_mcar_20[[paste(sim)]] <- simulate_missingness
}
for (sim in 1:100) {
simulate_missingness <- simulate_missing(data = synthetic_data_subset,
var = "selfcare",
proportion = 0.2,
miss_mech = "MCAR")
results_mcar_20[[paste(sim)]] <- simulate_missingness
}
results_mcar_20 <- list()
for (sim in 1:100) {
test <- simulate_missing(data = synthetic_data_subset,
var = "selfcare",
proportion = 0.2,
miss_mech = "MCAR")
results_mcar_20[[paste(sim)]] <- test
}
results_mcar_20 <- list()
for (sim in 1:100) {
test <- simulate_missingness(data = synthetic_data_subset,
var = "selfcare",
proportion = 0.2,
miss_mech = "MCAR")
results_mcar_20[[paste(sim)]] <- test
}
View(results_mcar_20)
View(results_mcar_20)
simulate_missing_t1 <- function(data, var, proportion, miss_mech){
data$id <- 1:nrow(data)
data_subset_t1 <- data[, c("id",
"randomisation",
"sex",
"age_cat",
"education_cat",
"hypertension",
"heart_disease",
"heart_failure",
paste0(var, "_t0"),
paste0(var, "_t1"))]
patterns <- matrix(c(rep(1, 9), 0),
nrow = 1,
byrow = TRUE)
data_subset_t1_missing <- mice::ampute(data_subset_t1,
prop = proportion,
patterns = patterns,
mech = miss_mech)
data_subset_t1_missing_output <-
data_subset_t1_missing$amp
data_t1_missing_only <-
data_subset_t1_missing_output[is.na(data_subset_t1_missing_output[[paste0(var, "_t1")]]), ]
data_t1_missing_only[[paste0(var, "_t2")]] <- NA
return(list(data_subset_t1_missing_output, data_t1_missing_only, data))
}
create_t2_input <- function(data, var, data_subset_t1_missing_output){
data_t1_complete <-
data_subset_t1_missing_output[complete.cases(data_subset_t1_missing_output), ]
data_t1_complete_id <- data_t1_complete[, "id"]
data_t2 <- data[data$id %in% data_t1_complete_id,
c("id",
"randomisation",
"sex",
"age_cat",
"education_cat",
"hypertension",
"heart_disease",
"heart_failure",
"selfcare_t0",
paste0(var, "_t2"))]
return(list(data_t1_complete, data_t2))
}
simulate_missing_t2 <- function(data_t2_subset, var, proportion, miss_mech){
patterns <- matrix(c(rep(1, 9), 0),
nrow = 1,
byrow = TRUE)
data_subset_t2_missing <- mice::ampute(data_t2_subset,
prop = proportion,
patterns = patterns,
mech = miss_mech)
data_subset_t2_missing_output <-
data_subset_t2_missing$amp[, c("id", paste0(var, "_t2"))]
return(data_subset_t2_missing_output)
}
combine_simulations <- function(data_t1_missing, data_t1_complete, data_t2){
data_t2_t1_merge <- merge(data_t1_complete, data_t2, by = "id")
simulation_output <- rbind(data_t1_missing, data_t2_t1_merge)
simulation_output <- simulation_output[order(simulation_output$id), ]
return(simulation_output)
}
simulate_missingness <- function(data, var, proportion, miss_mech){
t1_output <- simulate_missing_t1(data = data,
var = var,
proportion = proportion,
miss_mech = miss_mech)
t2_input <- create_t2_input(data = t1_output[[3]],
var = var,
data_subset_t1_missing_output = t1_output[[1]])
t2_output <- simulate_missing_t2(data_t2_subset = t2_input[[2]],
var = var,
proportion = proportion,
miss_mech = miss_mech)
simulation_output <- combine_simulations(data_t1_missing = t1_output[[2]],
data_t1_complete = t2_input[[1]],
data_t2 = t2_output)
return(simulation_output)
}
simulate_missingness_bulk <-function(data, var, proportion, miss_mech, iterations){
output <- list()
for (sim in 1:iterations) {
simulation <- simulate_missingness(data = data,
var = var,
proportion = proportion,
miss_mech = miss_mech)
output[[paste(sim)]] <- simulation
}
return(output)
}
results_mcar_20 <- simulate_missingness_bulk(data = synthetic_data_subset,
var = "selfcare",
proportion = 0.2,
miss_mech = "MCAR",
iterations = 100)
View(results_mcar_20)
source("R/00_load_functions.R")
source("R/00_load_package.R")
source("R/01_load_data.R")
source("R/02_data_edit.R")
source("R/03_create_synthetic_data.R")
source("R/04_simulate_missingness.R")
subset_vars <- c("selfcare", "physical_activity")
input_variables <-
colnames(synthetic_data_missing)[grepl(paste(subset_vars, collapse = "|"),
names(synthetic_data_missing))]
input_variables
imputation_var <- "selfcare"
input_variables <-
colnames(synthetic_data_missing)[grepl(imputation_var,
names(synthetic_data_missing))]
input_variables
data_to_impute <-
synthetic_data_missing[,
names(synthetic_data_missing) %in% c("unique_id",
input_variables)]
missing_input_vars <-
colnames(data_to_impute)[apply(data_to_impute,
2,
anyNA)]
missing_input_vars
data_to_impute <-
synthetic_data_missing[,
names(synthetic_data_missing) %in%
c("unique_id", missing_input_vars)]
View(data_to_impute)
data_remainder <- synthetic_data_missing[,
!names(synthetic_data_missing) %in%
missing_input_vars]
View(data_remainder)
rep(1,
ncol(data_to_impute) * ncol(data_to_impute))
matrix(rep(1,
ncol(data_to_impute) * ncol(data_to_impute)),
nrow = ncol(data_to_impute),
byrow = TRUE)
View(data_to_impute)
View(synthetic_data_missing)
